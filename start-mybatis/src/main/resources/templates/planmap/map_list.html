<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet"
	th:href="@{'/static/staticres/layui/css/layui.css'}" media="all">
<title></title>
</head>
<body>
	<fieldset class="layui-elem-field layui-field-title"
		style="margin-top: 20px;">
		<legend>平面图表格</legend>
	</fieldset>
	<div>
		<form action="#" method="post" name="Form" id="Form">
			<div class="layui-inline">
				<table>
					<tr>
						<td><input class="layui-input" id="nav-search-input"
							type="text" name="NAME" value="" placeholder="平面图名称" /></td>
						<td>
							<button type="button" onclick="query();"
								class="layui-btn layui-btn-radius">搜索</button>
						</td>
					</tr>
				</table>
			</div>
		</form>
	</div>
	<div>
		<input type="hidden" th:value="${rtle.logitude}" th:name="longitude"
			th:id="longitude" maxlength="32"> <input type="hidden"
			th:value="${rtle.latitude}" th:name="latitude" th:id="latitude"
			maxlength="32">
	</div>
	<table th:if="${flag} eq 'map'"  id="dates" lay-filter="test"></table>
	<table th:if="${flag} eq 'select'" id="selectdates" lay-filter="test"></table>
	<button type="button" class="layui-btn layui-btn-normal"
		onclick="add()">新增</button>
	<script th:src="@{'/static/staticres/layui/layui.js'}"></script>
	<script th:src="@{'/static/staticres/test/jquery.js'}"></script>

	<!--引入弹窗组件start-->
	<script
		th:src="@{'/static/staticres/plugins/attention/zDialog/zDrag.js'}"></script>
	<script
		th:src="@{'/static/staticres/plugins/attention/zDialog/zDialog.js'}"></script>
	<script type="text/javascript">
	if('[[${flag}]]' == 'map'){
	layui.use('table', function(){
	    var table = layui.table;
	    	table.render({
	            elem: '#dates'
	            ,url:'/map/selectPlanMapTable'
	            ,limit:5 //默认为10
	            ,cols: [
	            	
	            	[
	            	{title: '序号',templet: '#sortNumber'}
	                ,{field:'planMapId', width:400, title: '平面图ID'}
	                ,{field:'planMapName', width:170, title: '平面图名称'}
	                ,{field:'imageType',width:170,  title: '底图类型'}
	                ,{field:'fileName',width:170,  title: '底图名称'}
	                ,{field:'longitude',width:100,  title: '中心经度'}
	                ,{field:'latitude',width:100,  title: '中心纬度'}
	                ,{field:'remarks',width:170,  title: '备注'}
	                ,{field:'level',width:500, height:50, title: '操作',templet: function(d){
	                    //return'<a id="delete" class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteFile('+d.id+');">删除</a> ';
	                    return '<button type="button" onclick="gotoAreaEditOnMap('+d.id+');" class="layui-btn layui-btn-normal">平面图配置</button><div class="layui-btn-group"><button type="button" class="layui-btn layui-btn-sm"><i class="layui-icon" onclick="edit('+d.id+');"></i></button><button type="button" class="layui-btn layui-btn-sm"><i class="layui-icon" onclick="del('+d.id+');"></i></button></div>'
	                   }
	                }
	            	]
	            	
	            		]
	            ,page: true
	            ,limits:[5,10,15,20]
	            ,done:function(res, curr, count){
	                //数据的回调用，可不写
	                //底图类型
	            	$("[data-field='imageType']").each(function(){
	            	   　　if($(this).text()=='0'){
	            	      　　$(this).text("位图")
	            	      　　$(this).width("170px")
	            	      }else if($(this).text()=='1'){
	         	    		　$(this).width("170px")
	            	         $(this).text("矢量图")
	            	      }
	            	    	else{
	            	    		　$(this).width("170px")
	            	    		 $(this).text("底图类型")
	            	    	}
	            	   });
	            }
	        });        
	    });
}
	if('[[${flag}]]' == 'select'){
	layui.use('table', function(){
	    var table = layui.table;
	    	table.render({
	            elem: '#selectdates'
	            ,url:'/map/selectTable?name='+'[[${name}]]'
	            ,limit:5 //默认为10
	            ,cols: [
	            	
	            	[
	            	{title: '序号',templet: '#sortNumber'}
	                ,{field:'planMapId', width:400, title: '平面图ID'}
	                ,{field:'planMapName', width:170, title: '平面图名称'}
	                ,{field:'imageType',width:170,  title: '底图类型'}
	                ,{field:'fileName',width:170,  title: '底图名称'}
	                ,{field:'longitude',width:100,  title: '中心经度'}
	                ,{field:'latitude',width:100,  title: '中心纬度'}
	                ,{field:'remarks',width:170,  title: '备注'}
	                ,{field:'level',width:500, height:50, title: '操作',templet: function(d){
	                    //return'<a id="delete" class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteFile('+d.id+');">删除</a> ';
	                    return '<button type="button" onclick="gotoAreaEditOnMap('+d.id+');" class="layui-btn layui-btn-normal">平面图配置</button><div class="layui-btn-group"><button type="button" class="layui-btn layui-btn-sm"><i class="layui-icon" onclick="edit('+d.id+');"></i></button><button type="button" class="layui-btn layui-btn-sm"><i class="layui-icon" onclick="del('+d.id+');"></i></button></div>'
	                   }
	                }
	            	]
	            	
	            		]
	            ,page: false
	            ,limits:false
	            ,done:function(res, curr, count){
	                //数据的回调用，可不写
	                //底图类型
	            	$("[data-field='imageType']").each(function(){
	            	   　　if($(this).text()=='0'){
	            	      　　$(this).text("位图")
	            	      　　$(this).width("170px")
	            	      }else if($(this).text()=='1'){
	         	    		　$(this).width("170px")
	            	         $(this).text("矢量图")
	            	      }
	            	    	else{
	            	    		　$(this).width("170px")
	            	    		 $(this).text("底图类型")
	            	    	}
	            	   });
	            }
	        });        
	    });
}
//添加平面图
function add(){
	addDiag = new Dialog();
	addDiag.Width = "40%";
	addDiag.Height = "60%";
	addDiag.Title = "新增";
	addDiag.URL = "Add";
	addDiag.OKEvent = function(){
		addDiag.innerFrame.contentWindow.save();
	}
	addDiag.CancelEvent = function(){//关闭事件
		addDiag.close();
	}
	addDiag.show(); 
}
//删除
function del(id){
	Dialog.confirm("确认删除此平面图吗？",function(){
		$.ajax({
			type:"GET",
			url:"delete?id="+id,
			contentType: "application/json;charset=utf-8",
			success: function(data){
				if(data.msg == "success"){
					window.location.href="mapList";
				}else{
					Dialog.confirm("删除平面图失败！");
				}
			}
		});
	});
}
//更改
function edit(id){
	addDiag = new Dialog();
	addDiag.Width = "40%";
	addDiag.Height = "60%";
	addDiag.Title = "编辑";
	addDiag.URL = "edit?id="+id;
	addDiag.OKEvent = function(){
		addDiag.innerFrame.contentWindow.save();
	}
	addDiag.CancelEvent = function(){//关闭事件
		addDiag.close();
	}
	addDiag.show(); 
}
//查询
function query(){
	var name = $("#nav-search-input").val();
	var data = {};
	data.name = name;
	window.location.href="select?name="+name;
}
//编辑平面图
function gotoAreaEditOnMap(id){
	window.location.href="EditOnMap?id="+id;
}

</script>
    <script type="text/html" id="sortNumber">
        {{d.LAY_TABLE_INDEX+1}}
    </script>
</body>
</html>