<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>加载并显示地图</title>
    <link th:href="@{/static/staticres/Gis/v4.6.5/css/ol.css}" rel="stylesheet" type="text/css">
    <script th:src="@{/static/staticres/Gis/v4.6.5/lib/ol.js}" type="text/javascript"></script>
    <link th:href="@{/static/staticres/Gis/map.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/static/addbar.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/static/staticres/plugins/ol3-measuretool-master/measuretool.css}" rel="stylesheet" type="text/css">
    
	<link rel="stylesheet" th:href="@{'/static/staticres/ol6.3/ol.css'}" type="text/css">
	<link rel="stylesheet" th:href="@{'/static/staticres/ol3source/ol.css'}" type="text/css">
</head>

<body>
    <div id="map">
        <!-- <div id="mouse-position"></div> -->
    </div>
    <div  id="layerbox" class="layerbox usel" style="align:center;position:absolute;z-index:999;right: 50%; top: 0px;">
				<div id="layerbox_item"> <div class="show-list"> <i class="red-point"></i>
				<div class="layer_item switchmap item " th:onclick="'javascript:edit()'"><span class="icon"></span><span style="font-weight:bold;"  class="name">编辑(Edit)</span> </div>
                <div class="layer_item measure item " th:onclick="'javascript:save()'"><span class="icon"></span><span style="font-weight:bold;" class="name">保存(Save)</span> </div>				
                <div class="layer_item remote item " th:onclick="'javascript:remote()'"><span class="icon"></span><span style="font-weight:bold;" class="name">旋转(Remote)</span> </div>				
                <div class="layer_item remote item " th:onclick="'javascript:showXY()'"><span class="icon"></span><span style="font-weight:bold;" class="name">显示坐标轴</span> </div>				
                <div class="layer_item layercontrol item " th:onclick="'javascript:refresh()'"><span class="icon"></span><span style="font-weight:bold;" class="name">刷新(Refresh)</span> </div>
                <div class="layer_item fullscreenbutton item" id="fullscreenbutton" th:onclick="'javascript:range()'"><span class="icon"></span><span style="font-weight:bold;" class="name">测距(Range)</span> </div>
	</div></div></div>
    
	
	
    <input type="hidden" th:value="${latitude}" th:id="latitude">
    <input type="hidden" th:value="${longitude}" th:id="longitude">
    <input type="hidden" th:value="${areaNames}" th:id="anchorNames">
    <input type="hidden" th:value="${clockName}" th:id="clockName">
<!-- jQuery 2.2.3 -->
<script th:src="@{'/static/staticres/js/jquery-2.2.3.min.js'}"></script>
<script th:src="@{'/static/staticres/ol6.3/ol.js'}"></script>
<script th:src="@{'/static/staticres/ol3source/ol.js'}"></script>
<script th:src="@{'/static/staticres/plugins/ol-ext/style/settextpathstyle.js'}"></script>
<script th:src="@{'/static/staticres/plugins/ol-ext/control/layerswitchercontrol.js'}"></script>
<script th:src="@{'/static/staticres/plugins/ol3-measuretool-master/measuretool.js'}"></script>
<script type="text/javascript">
//获取经纬度的值
var longitude = $('#longitude').val();
var latitude = $('#latitude').val();


//添加移动鼠标显示地图经纬度功能
var mouseControl = new ol.control.MousePosition({
	coordinateFormat: ol.coordinate.createStringXY(8),
	projection: 'EPSG:4326'});

//初始化地图
function Map() {
    this.map = new ol.Map({
    	controls: ol.control.defaults().extend([
            new ol.control.FullScreen(),
            new ol.control.OverviewMap(),
            new ol.control.ScaleLine(),
            new ol.control.ZoomSlider(),
            new ol.control.ZoomToExtent()
        ]),
        target: 'map',
        view: new ol.View({
            center: [0, 0],
            zoom: 15
        })
    });
    this.map.addControl(mouseControl);
    this.controls,
    this.tileLayer;
    this.vectorLayer;
    this.vectorSource;
    this.imageLayer;
    this.imageSource;
}
Map.prototype = {
    constructor: Map,
    initialize: function () {
        this.initTileLayer();
        //this.initMousePositionControl();
        this.initVectorLayer();
        this.initImageLayer();
        this.addXY();
    },
    //初始化版权和地址
    initTileLayer: function (options) {
        this.tileLayer = new ol.layer.Tile({
            source: new ol.source.XYZ({
                attributions: new ol.Attribution({
                    html: "<a href='http://www.jlrtls.com/'>&copy; 旌霖科技</a>"
                }),
                //url: 'http://www.google.cn/maps/vt?lyrs=y@802&gl=cn&x={x}&y={y}&z={z}'
               	url:"http://www.google.cn/maps/vt?lyrs=m@189&gl=cn&x={x}&y={y}&z={z}"
            })
        });
        this.map.addLayer(this.tileLayer);
        var center = ol.proj.fromLonLat([parseFloat(longitude), parseFloat(latitude)]);
        var view = this.map.getView();
        view.setCenter(center);
    },
   //初始化鼠标位置
    initMousePositionControl: function () {
        var mousePositionControl = new ol.control.MousePosition({
            coordinateFormat: ol.coordinate.createStringXY(6),
            projection: 'EPSG:4326',
            className: 'custom-mouse-position',
            target: document.getElementById('mouse-position'),
            undefinedHTML: '&nbsp'
        });
        this.map.addControl(mousePositionControl);
    },
   
    initVectorLayer: function () {
        this.vectorSource = new ol.source.Vector({
            wrapX: false //不在地图上重复
        });
        this.vectorLayer = new ol.layer.Vector({
            source: this.vectorSource,
            style: new ol.style.Style({ //默认样式
                fill: new ol.style.Fill({
                    color: 'rgba(255, 204, 51, 0.5)'
                }),
                stroke: new ol.style.Stroke({
                    color: '#ffcc33',
                    width: 0
                }),
                image: new ol.style.Circle({
                    radius: 7,
                    fill: new ol.style.Fill({
                        color: '#ffcc33'
                    })
                })
            })
        });
        this.map.addLayer(this.vectorLayer);
    },
    //初始化图层
    initImageLayer: function (extent) {
        this.imageLayer = new ol.layer.Image({
            // source: this.imageSource
        })
        this.map.addLayer(this.imageLayer);
    },
    //添加坐标轴
    addXY: function () {
    	//坐标轴
    	var getAxisText = function(feature, resolution) {
    	    var text = feature.get('name');
    	    return text;
    	  };
    	  
    	var createAxisTextStyle = function(feature, resolution) {
    	  var align = "center";
    	  var baseline = "middle";
    	  var size = "14px";
    	  var offsetX = 0;
    	  var offsetY = 50;
    	  var weight = "bold";		// normal
    	  var rotation = 0;
    	  var font = weight + ' ' + size + ' ' + 'Arial';
    	  var fillColor = "#FF0000";
    	  var outlineColor = "#FFFFFF";
    	  var outlineWidth = 6;

    	  return new ol.style.Text({
    	    textAlign: align,
    	    textBaseline: baseline,
    	    font: font,
    	    text: getAxisText(feature, resolution),
    	    fill: new ol.style.Fill({color: fillColor}),
    	    stroke: new ol.style.Stroke({color: outlineColor, width: outlineWidth}),
    	    offsetX: offsetX,
    	    offsetY: offsetY,
    	    rotation: rotation
    	  });
    	};

    	function axisStyleFunction(feature, resolution) {
    	return [new ol.style.Style({
    	  stroke: new ol.style.Stroke({
    	    color: 'green',
    	    width: 4
    	  })
    	})];
    	}

    	//坐标轴的数据
    	var vectorAxis = new ol.layer.Vector({
    			title: "坐标轴",  
    			source: new ol.source.Vector({
    				   url:'json_coordinate_axis.do',
    	  			format: new ol.format.GeoJSON()
    				}),
    			style: axisStyleFunction
    		});

    	vectorAxis.setTextPathStyle(function (f)
    			{	return [ new ol.style.Style(
    				{	text: new ol.style.TextPath(
    					{	text: f.get("name"),
    						font: "bold 15px Arial",
    						fill: new ol.style.Fill ({ color:"#FF0000" }),
    						stroke: new ol.style.Stroke({ color:"#FFFFFF", width:6 }),
    						textBaseline: "middle",
    						textAlign: "center",
    						rotateWithView: false,
    						textOverflow: "visible",
    						minWidth: 2
    					})
    				})]
    			}, 
    			3);    
        this.map.addLayer(vectorAxis);
    },
    //添加图片
    addImage: function (extent, url) {
        var imageExtent = extent;
        this.imageSource = new ol.source.ImageStatic({
            url: url,
            projection: 'EPSG:3857',
            imageExtent: ol.proj.transformExtent(imageExtent, 'EPSG:4326', 'EPSG:3857')
        })
        this.imageLayer.setSource(this.imageSource);
    },
    //添加时钟
    addClockIcon: function (lonlat, tip) {
        var point = new ol.geom.Point(ol.proj.transform(lonlat, 'EPSG:4326', 'EPSG:3857'));
        var pointFeature = new ol.Feature(point);
        pointFeature.setStyle(
            new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 0.5],
                    crossOrigin: 'anonymous',
                    src: '../static/staticres/dist/img/clocksource48px.png'
                }),
				text: new ol.style.Text({
					text: tip,
					scale: 1.3,
					fill: new ol.style.Fill({
					  color: '#000000'
					}),
					stroke: new ol.style.Stroke({
					  color: '#FFFF99',
					  width: 3.5
					})
				})
            })
        );
        this.vectorSource.addFeature(pointFeature);
    },
    //添加基站
    addIcon: function (lonlat, tip) {
        var point = new ol.geom.Point(ol.proj.transform(lonlat, 'EPSG:4326', 'EPSG:3857'));
        var pointFeature = new ol.Feature(point);
        pointFeature.setStyle(
            new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 0.5],
                    crossOrigin: 'anonymous',
                    src: '../static/staticres/dist/img/anchor48px.png'
                }),
				text: new ol.style.Text({
					text: tip,
					scale: 1.3,
					fill: new ol.style.Fill({
					  color: '#000000'
					}),
					stroke: new ol.style.Stroke({
					  color: '#FFFF99',
					  width: 3.5
					})
				})
            })
        );
        this.vectorSource.addFeature(pointFeature);
    },
}

var map = new Map();
map.initialize();

//加载基站
function addIcon(lonlat, tip) {
    map.addIcon(lonlat, tip);
}
//加载时钟
function addClockIcon(lonlat, tip){
	map.addClockIcon(lonlat, tip);
}
//基站名称
var array = $('#anchorNames').val().split(',')
for(var i =0;i < array.length;i++){
	addIcon([parseFloat(longitude), parseFloat(latitude)],array[i]);
}
//时钟名称
addClockIcon([parseFloat(longitude), parseFloat(latitude)],$('#clockName').val());

//加载图片
function addImage(extent, url) {
    map.addImage(extent, url);
}
//addImage([parseFloat(longitude)-0.5, parseFloat(latitude)-0.5, parseFloat(longitude)+0.5, parseFloat(latitude)+0.5], "../static/staticres/planmap/81c18fd6d65444d6aa8f4bd5aff859f2.png");



//点击编辑
function edit(){
	
}
//测距
function range(){
	
}
//保存
function save(){
	
}
//旋转
function remote(){
	
}
//刷新
function refresh(){
	
}
//展示
function show(){
	
}
/*
//显示坐标轴
function showXY(){
	var x1 = parseFloat(longitude)-2;
	var x2 = parseFloat(longitude)+2;
	var y1 = parseFloat(latitude)-2;
	var y2 = parseFloat(latitude)+2;
	//坐标原点
	var y0 = parseFloat(latitude);
	var x0 = parseFloat(longitude);
	
} 
*/
</script>
</body>

</html>